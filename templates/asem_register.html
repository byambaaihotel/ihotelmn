{% extends "asem.html" %}
{% block content %}
<div class="gap"></div>
<div class="container">
    <div class="row" data-gutter="60">
        <div class="col-md-4 col-md-offset-4">
            <h3>ASEM 11 Login</h3>
            <form>
                <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                    <label>Email</label>
                    <input class="form-control" placeholder="@" type="text" id="email"/>
                </div>
                <div class="form-group form-group-icon-left"><i class="fa fa-lock input-icon input-icon-show"></i>
                    <label>Password</label>
                    <input class="form-control" type="password" placeholder="*****" id="password"/>
                </div>
            <div class="alert alert-danger" id='login-alert'>
                <button class="close" type="button" data-dismiss="alert"><span aria-hidden="true">×</span>
                </button>
                <p class="text-small"></p>
            </div>
                <input class="btn btn-primary" type="button" value="Login" id="login"/>
                <a class="popup-text" id="forgot_text" href="#forgot-dialog" data-effect="mfp-zoom-out">Forgot password?</a>
            </form>
            <br />
            <div class="alert alert-success hidden" id="register-success1">
                <button class="close" type="button" data-dismiss="alert"><span aria-hidden="true">×</span>
                </button>
                <p class="text-small"></p>
            </div>
            <div class="alert alert-danger hidden" id='login-alert1'>
                <button class="close" type="button" data-dismiss="alert"><span aria-hidden="true">×</span>
                </button>
                <p class="text-small"></p>
            </div>
            <div class="mfp-with-anim mfp-hide mfp-dialog mfp-search-dialog" id="forgot-dialog">
                <form>
                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Email</label>
                        <input class="form-control" placeholder="example@example.com" type="text" id="forgot_email"/>
                    </div>
                    <input class="btn btn-primary" type="button" value="Send" id="forgot_password"/>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripting %}
    {{parent()}}
    <script type="text/javascript">
        $('#login').click(function(){
             $('.alert').hide(0);
        var $this = $(this);
        $this.after('<div id="loading"></div>');
        $this.addClass('disabled');
           $.post("login.php", {
                email: $('#email').val(),
                password: $('#password').val()
                }, function (result) {
                    if(result==1){
                        window.location.replace("index.php");  
                    }
                    else{
                        $('#loading').remove();
                        $this.removeClass('disabled');
                        $('#login-alert').fadeIn(500);
                        $('#login-alert p').text('Username or password incorrect!');
                    }
            });
        });
        $('#forgot_password').click(function(){
           $.post("user.php", {
                forgot_password: $('#forgot_email').val(),
                }, function (result) {
                    if(result==1){
                        $(".mfp-close").trigger('click');
                        $('#register-success1').removeClass('hidden');
                        $('#register-success1 p').text('Та и-мэйл рүүгээ орж нууц үгээ сэргээх болно.');
                    }
                    else{
                        $(".mfp-close").trigger('click');
                        $('#login-alert1').removeClass('hidden');
                        $('#login-alert1 p').text('Таны и-мэйл хаяг буруу байна!');
                    }
            });
        });
        $('#add').click(function(){
           $.post("user.php", {
                email: $('#remail').val(),
                username: $('#rusername').val(),
                password: $('#rpassword').val()
                }, function (result) {
                    if(result==1){
                        $('#register-success').removeClass('hidden');
                        $('#register-success p').text('Бүртгэл амжилттай. Та и-мэйл рүүгээ орж бүртгэлийг идэвхижүүлнэ үү.');
                    }
                    else{
                        $('#register-alert').removeClass('hidden');
                        $('#register-alert p').text('Та өмнө нь бүртгэгдсэн эсвэл бүртгэлийн мэдээлэл буруу байна!');
                    }
            });
        });
    </script>
{% endblock %}



