{% extends "base.html" %}
{% block content %}
    <div class="container">
        <ul class="breadcrumb">
            <li><a href="index.html">Нүүр</a></li>
            <li class="active">{{location}}</li>
        </ul>
        <div style="height:20px"></div>
        <input type="hidden" id="location_1" value="{{location}}"/>
        <input type="hidden" id="country" value="{{country}}"/>
        <input type="hidden" id="start_1" value="{{start}}"/>
        <input type="hidden" id="end_1" value="{{end}}"/>
        <input type="hidden" id="num_person_1" value="{{num_person}}"/>
        <form class="booking-item-dates-change mb40">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group form-group-icon-left"><i class="fa fa-map-marker input-icon input-icon-hightlight"></i>
                        <label>Зорьчих газар</label>
                        <input class="form-control" id="location" name='location' value="{{location}}" type="text" />
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="input-daterange">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group form-group-icon-left"><i class="fa fa-calendar input-icon input-icon-hightlight"></i>
                                    <label>Ирэх</label>
                                    <input class="form-control" id="start" name="start" type="text" data-date-format="yyyy-mm-dd"  {%if start %} value="{{start}}" {%else %} value="2016-06-01" {%endif%}  />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group form-group-icon-left"><i class="fa fa-calendar input-icon input-icon-hightlight"></i>
                                    <label>Гарах</label>
                                    <input class="form-control" id="end" name="end" type="text" data-date-format="yyyy-mm-dd" {%if end %} value="{{end}}" {%else %} value="2016-07-01" {%endif%} />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group form-group- form-group-select-plus">
                                <label>Зочид</label>
                                <select id="persons" class="form-control" name="persons">
                                    <option  selected="selected" >{{persons}}</option>
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                    <option>6</option>
                                    <option>7</option>
                                    <option>8</option>
                                    <option>9</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>13</option>
                                    <option>14</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group form-group-select-plus">
                                <label>Өрөө</label>
                                <select id="guests" class="form-control" name="guests">
                                    <option selected="selected" >{{guests}}</option>
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                    <option>6</option>
                                    <option>7</option>
                                    <option>8</option>
                                    <option>9</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>13</option>
                                    <option>14</option>
                                </select>
                            </div>
                        </div>
                        <div class='col-md-6'>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button class="btn btn-primary" type="submit">Хайх</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="row">
            <div class="col-md-3">
                <aside class="booking-filters booking-filters-white">
                    <h3>Шүүлт</h3>
                    <div class='input-ajax'>
                        <input id="tags" class="form-control" placeholder="Буудлын нэр ..." type="text" style="margin:10px; width:92%" />
                    </div>
                    <ul class="list booking-filters-list">  
                        <li>
                        <h5 class="booking-filters-title"></h5>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" id="asem_box" name="asem_box" value="5"/>ASEM MONGOLIA 2016 
                        </div>
                        <h5 class="booking-filters-title"></h5>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" id="tour_box" name="tour_box" value="5"/>Амралтын газрууд 
                        </div>
                        </li>
                        <li id="price_filter">
                        <h5 class="booking-filters-title">Үнэ</h5>
                        <input type="text" id="price-slider">
                        </li>
                        <li id="stars_filter">
                        <h5 class="booking-filters-title">Од</h5>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="stars" value="5"/>5 одтой
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="stars" value="4" />4 одтой 
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox"name="stars" value="3"/>3 одтой
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="stars" value="2"/>2 одтой
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="stars" value="1"/>1 одтой
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox"  name="stars" value="0"/>Одгүй
                        </div>
                        </li>
                        <li>
                        <h5 class="booking-filters-title">Нэмэлт</h5>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="others" value="wifi" />Утасгүй интернет
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="others" value="parking" />Зогсоол
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="others" value="pool" />Бассейн
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="others" value="saun" />Саун
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox"  name="others" value="famroom"/>Гэр бүлийн өрөө
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="others" value="rest" />Баар
                        </div>
                        <li>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="food_drink" value="restraurant" />Ресторант
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="food_drink" value="room_service" /> Өрөөний үйлчилгээ
                        </div>
                        </li>
                        <li>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="pool_spa" value="fitness_center" />Бялдаржуулах төв
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="pool_spa" value="spa" />СПА
                        </div>
                        </li>
                        <li>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="transport" value="car_rentral" />Машин түрээс
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="transport" value="airport_shuttle_free" />Airport Shuttle (free)
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="transport" value="airport_shuttle_surcharge" />Airport Shuttle (surchange)
                        </div>
                        </li>
                        <li>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="entertainment" value="baby_sitting_child_services" />Baby sitting
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="entertainment" value="playground" /> Тоглоомын талбай
                        </div>
                        </li>
                        <li>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="miscellaneous" value="elevator" /> Цахилгаан шат
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="miscellaneous" value="non_smoking_rooms" />Non-smoking Rooms
                        </div>
                        <div class="checkbox">
                            <input class="i-check" type="checkbox" name="miscellaneous" value="soundproof_rooms" /> Дуу тусгаарлагчтай өрөө
                        </div>
                        </li>
                        </li>
                    </ul>
                </aside>
            </div>
            <div class="col-md-9">
                <div class="nav-drop booking-sort small-top">
                    <h5 class="booking-sort-title"><a href="#">Эрэмбэлэх:<i class="fa fa-angle-down"></i><i class="fa fa-angle-up"></i></a></h5>
                    <ul id="sorting" class="nav-drop-menu">
                        <li id="pricedown"><a href="#" name="sort" sort="priceup">Үнэ (ихээс бага руу)</a>
                        </li>
                        <li id="priceup"><a href="#" name="sort" sort="pricedown">Үнэ (багаас их рүү)</a>
                        </li>
                        <li id="starup"><a href="#" name="sort" sort="starup">Одоор (ихээс бага руу )</a>
                        </li>
                        <li id="stardown"><a href="#" name="sort" sort="stardown">Одоор (багаас их рүү)</a>
                        </li>
                    </ul>
                </div>
                <div class="nav-drop booking-sort small-top" style="float:right;">
                    <h5 id="hotel_list"><a href="#" title="Жагсаалт"><i class="fa fa-list"></i>Жагсаалт</a></h5>
                    <h5 id="hotel_map"><a href="#" title="Газрын зураг"><i class="fa fa-map-marker"></i>Газрын зураг</a></h5>
                </div>
                <div id="maps_hotel" style="display: none;">
                </div>
                <ul class="booking-list" id="hotels">
                    {% for res in results %}
                    <li>
                    {% if res.sold_out %}
                    <a class="booking-item" id="{{res.objectId}}" asem="0" title="{{res.name}}">
                        {% else %}
                        <a class="booking-item" id="{{res.objectId}}" asem="0" title="{{res.name}}"href="#" name="detail">
                            {% endif %}

                            <div class="row">
                                <div class="col-md-3">
                                    <div class="booking-item-img-wrap">
                                        <img src="{{res.cover_image}}" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" />
                                        <div class="booking-item-img-num"><i class="fa fa-picture-o"></i>{{res.images|length}}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class='flex'>
                                        <div>
                                            <h5 class="booking-item-title">{{res.name}}</h5>
                                        </div>
                                        <div>
                                            <div class="booking-item-rating mrg-left">
                                                <ul class="icon-group booking-item-rating-stars">
                                                    {% for i in range(1, res.stars) %}
                                                    <li><i class="fa fa-star"></i></li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <small class="booking-item-address"><i class="fa fa-map-marker"></i> {{res.address}}</small><br><br><small class="booking-item-address">{{res.short_desc}}</small>
                                </div>
                                <div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px"> эхлэх үнэ</span><span
                                        class="booking-item-price">{{res.min_rate | number_format }}{%if res.asem == 1%}${%else%}₮{%endif%}</span><span>/өдөр</span><span class="small-left btn btn-primary {% if res.sold_out %} sold {%endif%}" id="{{res.objectId}}">{%if res.sold_out%} Sold out {%else%} Өрөө сонгох {%endif%}</span>
                                </div>
                            </div>
                        </a>
                        </li>
                        {% endfor %}
                    </ul>
                    <div id="loadmoreajaxloader" style="display:none;"><center><img style="width: 20px;" src="img/ajax-loader.gif" /></center></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %} 
{% block scripting %}
    {{parent()}}
    <script type="text/javascript" src="js/infobubble.js" charset="utf-8"></script>
    <script type="text/javascript">

    var checkedValues1; var checkedValues2; var checkedValues3; var checkedValues4; var checkedValues5; var checkedValues6; var checkedValues7;
    var values1; var values2; var values3; var values4; var values5; var values6; var values7;
    var keyup = false;
    var loadSkip = 0;
    var checkSkip = true;
    var asem = false;
    var soldClass = "";
    var innerHtml = "";
    var tour = false;
    var results = [];

    {% for res in results %}
    {% if res.geolocation %}
    results.push({lat: {{res.geolocation.latitude}}, lng:
        {{res.geolocation.longitude}}, id: '{{res.objectId}}', avg: '{{res.min_rate | number_format}}'});
    {% endif %}
    {% endfor %}

    var map = new google.maps.Map(document.getElementById('maps_hotel'), {
        zoom: 13,
        center: new google.maps.LatLng(47.912318, 106.913816),
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    var infoBubble; var infoBubble2; var countinfo = 0; var currency = ""; var from = ""; var marker;

    function initMap(resulst) {
        map = new google.maps.Map(document.getElementById('maps_hotel'), {
            zoom: 13,
            center: new google.maps.LatLng(47.912318, 106.913816),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        for(var i = 0; i<results.length; i++){
            
            marker = new google.maps.Marker({
                position: {lat: results[i].lat, lng: results[i].lng},
            });

            if(asem){
                currency = "$ "+results[i].avg;
                from = "from";
            }else{
                currency = results[i].avg+" ₮";
                from = "эхлэх";
            }

            infoBubble = new InfoBubble({
                content: '<h5 id="'+results[i].id+'" onclick="help(this.id);"style="text-align: center; cursor: pointer; margin-bottom: 0px; color: #FFF;font-weight: bold;">'+
                currency+'</h5>',
                       arrowSize: 8,
                       maxWidth: 200,
                       minWidth: 100,
                       minHeight: 35,
                       backgroundColor: '#FF0C0C',
                       hideCloseButton: true,
                       arrowPosition: 50,
                       padding: 4,
                       borderRadius: 8,
                       arrowStyle: 0,
                       map: map,
                       shadowStyle: 1
            });
            infoBubble.open(map, marker);
        }
    }
    function help(tid){
        var contentString;
        $.ajax({
            type: "POST",
            url: "index.php",
            data: {mapGeoId:tid},
            success: function(data, textStatus, jqXHR)
        {
            if (countinfo >= 1) {
                if (infoBubble2.isOpen()) {
                    infoBubble2.close();
                }
            }
            countinfo++;
            var hotel = $.parseJSON(data);
            marker = new google.maps.Marker({
                position: {lat: hotel['latitude'], lng: hotel['longitude']},
            });


            var stars ='<div style="font-size: 13px;margin:0;line-height: 20px;"'+
            'class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'; 
        for(var i = 0; i<hotel['stars']; i++){ 
            stars+='<li><i class="fa fa-star"></i></li>';
        }
        stars+='</ul></div>';
        contentString='<a href="index.php?detail='+hotel['id']+'&depart='+$("#start_1").val()+'&end='+$("#end_1").val()+
            '&guests='+$("#guests").val()+'&rooms='+$("#rooms").val()+'"><div id="content">'+
            '<img style="width: 276px; max-height: 180px;overflow: hidden;"src="'+hotel['cover_image']+'"><h1></h1>'+
            '<h4 style="margin: 0;">'+hotel['name']+'<br/>'+stars+'<span style="margin: 0; float:right" class="booking-item-price"><span style="margin: 0; font-size:13px" class="booking-item-price">'+from+'&nbsp;&nbsp;&nbsp;</span>'+currency+'</span>'+
            '</h4></div></a>';

        infoBubble2 = new InfoBubble({
            maxWidth: 300,
                    minWidth: 300,
                    minHeight: 290,
                    hideCloseButton: true,
                    overflow: 'hidden',
                    content: contentString
        });
        infoBubble2.open(map, marker);
        google.maps.event.addListener(map,'click', function() {
            infoBubble2.close();
        });
        }
        });
    }
    function details(i){
        event.preventDefault();
        var curId = $(i).attr('id');
        var start = $("#start_1").val();
        var end = $("#end_1").val();
        var location = $("#location_1").val();
        var guests = $("#guests").val();
        var rooms = $("#rooms").val();
        var url = "index.php?detail=" + curId +"&depart=" + start + "&end=" + end + "&guests=" +guests+ "&rooms=" +rooms; 
        window.location.replace(url);
    }
    $(document).ready(function() {
        var availableTags = ['q','x'];
        $.ajax({
            type: "POST",
            url: "search.php",
            data: {autocomplete:1, city:'Ulaanbaatar', type: "Hotel"},
            success: function(data, textStatus, jqXHR)
        {
            availableTags = $.parseJSON(data);

            $( "#tags" ).autocomplete({
                source: availableTags
            });
        }
        });
        $('input.date-pick, .input-daterange, .date-pick-inline').datepicker({
            todayHighlight: true
        });
        $('input.date-pick, .input-daterange input[name="start_1"]').datepicker();
        $('.input-daterange input[name="end_1"]').datepicker();
        $('input.time-pick').timepicker({
            minuteStep: 15,
            showInpunts: false
        })
        $(document).on("click",'span[name=detail]', function( event ) {
            event.preventDefault();
            var curId = $(this).attr('id');
            var start = $("#start_1").val();
            var end = $("#end_1").val();
            var location = $("#location_1").val();
            var guests = $("#guests").val();
            var rooms = $("#rooms").val();
            if($(this).attr('asem') == 0){
                var url = "index.php?detail=" + curId +"&depart=" + start + "&end=" + end + "&guests=" +guests+ "&rooms="+rooms;
            }
            else{
                var url = "index.php?detail=" + curId +"&depart=" + start + "&end=" + end + "&guests=" +guests+ "&rooms="+rooms;
            }
        window.location.replace(url);
        });
        $(document).on("click",'a[name=detail]', function( event ) {
            event.preventDefault();
            var detialId = $(this).attr('id');
            var curId = detialId;
            var start = $("#start_1").val();
            var end = $("#end_1").val();
            var location = $("#location_1").val();
            var guests = $("#guests").val();
            var rooms = $("#rooms").val();
            if($(this).attr('asem') == 0){
                var url = "index.php?detail=" + curId +"&depart=" + start + "&end=" + end + "&guests=" +guests+ "&rooms="+rooms;
            }
            else{
                var url = "index.php?detail=" + curId +"&depart=" + start + "&end=" + end + "&guests=" +guests+ "&rooms="+rooms;
            }
        window.location.replace(url);
        });
        $('input.date-pick-years').datepicker({
            startView: 2
        });
        $("input").on('ifChanged', function(event){
            $("#tags").val('');
            if(this.id !='asem_box'){
                if(this.id == "tour_box"){ 
                    $('#full-loader').remove();
                    $('#hotels').append('<div id="full-loader"><div id="loading"></div></div>');
                    if(this.checked) {
                        tour = true;
                        asem = false;
                        $("input[name='asem_box']").attr("checked", false);
                        $("input[name='asem_box']").parent().attr("class", "i-check");
                        $("#stars_filter").hide();
                        $("#price_filter").hide();
                        tour_checked();
                    }
                    else{
                        tour = false;
                        $("#stars_filter").show();
                        $("#price_filter").show();

                        checkedValues1 = $(' input[name="stars"]:checkbox:checked').map(function() {return this.value;}).get();
                        checkedValues2 = $(' input[name="others"]:checkbox:checked').map(function() {return this.value;}).get();
                        checkedValues3 = $(' input[name="entertainment"]:checkbox:checked').map(function() {return this.value;}).get();
                        checkedValues4 = $(' input[name="food_drink"]:checkbox:checked').map(function() {return this.value;}).get();
                        checkedValues5 = $(' input[name="pool_spa"]:checkbox:checked').map(function() {return this.value;}).get();
                        checkedValues6 = $(' input[name="transport"]:checkbox:checked').map(function() {return this.value;}).get();
                        checkedValues7 = $(' input[name="miscellaneous"]:checkbox:checked').map(function() {return this.value;}).get();

                        values1 = checkedValues1.toString();values2 = checkedValues2.toString();values3 = checkedValues3.toString();
                        values4 = checkedValues4.toString();values5 = checkedValues5.toString();values6 = checkedValues6.toString();
                        values7 = checkedValues7.toString();

                        var location = '{{location}}'.split(",");
                        var type = "Hotel";

                        if(checkedValues1.length !=0 || checkedValues2.length !=0 
                                || checkedValues3.length !=0 || checkedValues4.length !=0 
                                || checkedValues5.length !=0 || checkedValues6.length !=0 || checkedValues7.length !=0){
                            checked(values1, values2, values3, values4, values5, values6, values7, location[0], type);
                        }else{
                            not_checked(type);
                        }
                    }
                }
                else{

                    var checkedValues1 = $(' input[name="stars"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues2 = $(' input[name="others"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues3 = $(' input[name="entertainment"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues4 = $(' input[name="food_drink"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues5 = $(' input[name="pool_spa"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues6 = $(' input[name="transport"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues7 = $(' input[name="miscellaneous"]:checkbox:checked').map(function() {return this.value;}).get();

                    values1 = checkedValues1.toString();values2 = checkedValues2.toString();values3 = checkedValues3.toString();
                    values4 = checkedValues4.toString();values5 = checkedValues5.toString();values6 = checkedValues6.toString();
                    values7 = checkedValues7.toString();

                    var location = '{{location}}'.split(",");
                    var type = "Hotel";
                    if(tour){
                        type = "Resort";
                    } 

                    $('#full-loader').remove();
                    $('#hotels').append('<div id="full-loader"><div id="loading"></div></div>');

                    if(checkedValues1.length !=0 || checkedValues2.length !=0 
                            || checkedValues3.length !=0 || checkedValues4.length !=0 
                            || checkedValues5.length !=0 || checkedValues6.length !=0 || checkedValues7.length !=0){
                        checked(values1, values2, values3, values4, values5, values6, values7, location[0], type);
                    }else{
                        not_checked(type);
                    }
                }
            }
            else{
                $('#full-loader').remove();
                $('#hotels').append('<div id="full-loader"><div id="loading"></div></div>');
                if(this.checked) {
                    asem = true;
                    tour = false;
                    $("#stars_filter").show();
                    $("input[name='tour_box']").attr("checked", false);
                    $("input[name='tour_box']").parent().attr("class", "i-check");
                    asem_checked();

                }else{
                    asem = false;

                    checkedValues1 = $(' input[name="stars"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues2 = $(' input[name="others"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues3 = $(' input[name="entertainment"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues4 = $(' input[name="food_drink"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues5 = $(' input[name="pool_spa"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues6 = $(' input[name="transport"]:checkbox:checked').map(function() {return this.value;}).get();
                    checkedValues7 = $(' input[name="miscellaneous"]:checkbox:checked').map(function() {return this.value;}).get();

                    values1 = checkedValues1.toString();values2 = checkedValues2.toString();values3 = checkedValues3.toString();
                    values4 = checkedValues4.toString();values5 = checkedValues5.toString();values6 = checkedValues6.toString();
                    values7 = checkedValues7.toString();

                    var location = '{{location}}'.split(",");
                    var type = "Hotel";

                    if(checkedValues1.length !=0 || checkedValues2.length !=0 
                            || checkedValues3.length !=0 || checkedValues4.length !=0 
                            || checkedValues5.length !=0 || checkedValues6.length !=0 || checkedValues7.length !=0){
                        checked(values1, values2, values3, values4, values5, values6, values7, location[0], type);
                    }else{
                        not_checked(type);
                    }
                }
            }
        });
    });

    $("#hotel_map").click(function( event ) {
        $("#hotels").hide();
        $("#maps_hotel").show();
        initMap(results);
    });

    $("#hotel_list").click(function( event ) {
        $("#maps_hotel").hide();
        $("#hotels").show();
    });

    $("#search_a").click(function( event ) {
        var check = true;
        var start = $("#start").val();
        var end = $("#end").val();
        var location = $("#location").val();
        var persons = $("#num_people").val();

        if(location == ""){
            check =false;
        }
        if(check){
            var url = "index.php?start=" + start + "&end=" + end + "&location=" +location+"&persons="+persons;  
            window.location.replace(url);    
        }else{
            $("#alert_1").toggle();
            $("#location").css("border-color", "red");
        }   
    });
    $("#sorting a").click(function( event ) {
        $('#full-loader').remove();
        $('#hotels').append('<div id="full-loader"><div id="loading"></div></div>');
        var sort = $(this).attr('sort');

        checkedValues1 = $(' input[name="stars"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues2 = $(' input[name="others"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues3 = $(' input[name="entertainment"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues4 = $(' input[name="food_drink"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues5 = $(' input[name="pool_spa"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues6 = $(' input[name="transport"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues7 = $(' input[name="miscellaneous"]:checkbox:checked').map(function() {return this.value;}).get();

        values1 = checkedValues1.toString();values2 = checkedValues2.toString();values3 = checkedValues3.toString();
        values4 = checkedValues4.toString();values5 = checkedValues5.toString();values6 = checkedValues6.toString();
        values7 = checkedValues7.toString();

        var location = '{{location}}'.split(",");

        var data;
        if(asem){
            data = {data:sort, filter1:values1, filter2:values2, entertainment:values3, food_drink:values4, pool_spa:values5, transport:values6,
                miscellaneous:values7, city:location[0], asem:1, type: "Hotel"};
        }else{
            data = {data:sort, filter1:values1, filter2:values2, entertainment:values3, food_drink:values4, pool_spa:values5, transport:values6,
                miscellaneous:values7, city:location[0], type: "Hotel"};
        }
        $.ajax({
            type: "POST",
            url: "sort.php",
            data: data,
            success: function(data, textStatus, jqXHR)
        {
            $("#hotels").empty();
            var events = data['events'];
            var pages = data['pages'];
            var sort = data['sort'];
            $("#sorting").val(sort);
            results=[];
        $.each(events, function(idx, obj) {
            var index = idx+1;
            var string = "";
            results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
            for ($i=0; $i<obj.stars; $i++){
                string += '<i class="fa fa-star"></i></li>';
            }
            if(asem){ currency = "$ "+obj.rate; }else{ currency = obj.rate+" ₮";}
            if(obj.sold_out == 1){
                innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
            }else{
                innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
            }
            $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');
        });
        initMap(results);
        //alert(data);

        }
        });
    });
    $('#hotels').on('click', 'span[name=detail]',function(event) {
        event.preventDefault();
        var curId = $(this).attr('id');
        var start = $("#start_1").val();
        var end = $("#end_1").val();
        var location = $("#location_1").val();
        var guests = $("#guests").val();
        var rooms = $("#rooms").val();
        var url = "index.php?detail=" + curId +"&depart=" + start + "&end=" + end + "&guests=" +guests+ "&rooms=" +rooms; 
        window.location.replace(url);
    });
    $('#hotels').on('click', 'a[name=detail]',function(event) {
        event.preventDefault();
        var aseme = $(this).attr("asem");
        var curId = $(this).attr('id');
        var start = $("#start_1").val();
        var end = $("#end_1").val();
        var location = $("#location_1").val();
        var guests = $("#guests").val();
        var rooms = $("#rooms").val();
        var url = "index.php?detail=" + curId +"&depart=" + start + "&end=" + end + "&guests=" +guests+ "&rooms=" +rooms; 
        window.location.replace(url);
    });
    function not_checked(type){
        var location = '{{location}}'.split(",");
        var data;
        if(asem){
            data={not_checked:1, city:location[0], asem:1, type: type};
        }else{
            data={not_checked:1, city:location[0], type: type};
        }
        $.ajax({
            type: "POST",
            url: "search.php",
            data: data,
            success: function(data, textStatus, jqXHR)
        {
            $("#hotels").empty();

            var events = data['events'];
            var pages = data['pages'];
            results = [];
            availableTags = [];
            $.each(events, function(idx, obj) {
                var index = idx+1;
                var string = "";
                availableTags.push(obj.name);  
                results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                for ($i=0; $i<obj.stars; $i++){
                    string += '<i class="fa fa-star"></i></li>';
                }
                if(asem){
                    currency = "$ "+obj.rate;
                    from = "from";
                }else{
                    currency = obj.rate+" ₮";
                    from = "эхлэх";
                }
                if(obj.sold_out == 1){
                    innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                }else{
                    innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                }
                $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');

            });
            $( "#tags" ).autocomplete({
                source: availableTags
            });
            initMap(results);
        }
        });
    }
    function checked(values1, values2, values3, values4, values5, values6, values7, location, type){
        var data;
        if(asem){
            data={data:values1, filter:values2, entertainment:values3, food_drink:values4, pool_spa:values5, transport:values6, miscellaneous:values7, city:location, asem:1, type: type};
        }else{
            data={data:values1, filter:values2, entertainment:values3, food_drink:values4, pool_spa:values5, transport:values6, miscellaneous:values7, city:location, type: type};
        }
        $("#tags").val('');
        $.ajax({
            type: "POST",
            url: "search.php",
            data: data,
            success: function(data, textStatus, jqXHR)
        {
            $("#hotels").empty();
            var events = data['events'];
            var pages = data['pages'];
            results=[];
            availableTags = [];
            $.each(events, function(idx, obj) {
                var index = idx+1;
                var string = "";
                availableTags.push(obj.name);  
                results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                for ($i=0; $i<obj.stars; $i++){
                    string += '<i class="fa fa-star"></i></li>';
                }
                if(asem){
                    currency = "$ "+obj.rate;
                    from = "from";
                }else{
                    currency = obj.rate+" ₮";
                    from = "эхлэх";
                }
                if(obj.sold_out == 1){
                    innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                }else{
                    innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                }
                $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');

            });
            $( "#tags" ).autocomplete({
                source: availableTags
            });
            initMap(results);
        }
        });
    }
    function asem_checked(){
        $("#tags").val('');

        checkedValues1 = $(' input[name="stars"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues2 = $(' input[name="others"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues3 = $(' input[name="entertainment"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues4 = $(' input[name="food_drink"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues5 = $(' input[name="pool_spa"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues6 = $(' input[name="transport"]:checkbox:checked').map(function() {return this.value;}).get();
        checkedValues7 = $(' input[name="miscellaneous"]:checkbox:checked').map(function() {return this.value;}).get();

        values1 = checkedValues1.toString();values2 = checkedValues2.toString();values3 = checkedValues3.toString();
        values4 = checkedValues4.toString();values5 = checkedValues5.toString();values6 = checkedValues6.toString();
        values7 = checkedValues7.toString();

        var location = '{{location}}'.split(",");

        if(checkedValues1.length !=0 || checkedValues2.length !=0  || checkedValues3.length !=0 || checkedValues4.length !=0 
                || checkedValues5.length !=0 || checkedValues6.length !=0 || checkedValues7.length !=0){

                    $.ajax({
                        type: "POST",
                        url: "search.php",
                        data: {data:values1, filter:values2, entertainment:values3, food_drink:values4, pool_spa:values5, transport:values6, miscellaneous:values7,
                            city:location[0], asem:1, type: "Hotel"},
                        success: function(data, textStatus, jqXHR)
                    {
                        $("#hotels").empty();

                        var events = data['events'];
                        var pages = data['pages'];
                        results=[];
                        availableTags = [];
                        $.each(events, function(idx, obj) {
                            var index = idx+1;
                            var string = "";
                            availableTags.push(obj.name);  
                            results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                            for ($i=0; $i<obj.stars; $i++){
                                string += '<i class="fa fa-star"></i></li>';
                            }
                            if(asem){ currency = "$ "+obj.rate; }else{ currency = obj.rate+" ₮";}
                            if(obj.sold_out == 1){
                                innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                            }else{
                                innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                            }
                            $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');

                        });
                        $( "#tags" ).autocomplete({
                            source: availableTags
                        });
                        initMap(results);
                    }
                    });
                }else{
                    $.ajax({
                        type: "POST",
                        url: "search.php",
                        data: {changed_asem:1, city:location[0], asem:1, type: "Hotel"},
                        success: function(data, textStatus, jqXHR)
                    {
                        $("#hotels").empty();

                        var events = data['events'];
                        var pages = data['pages'];
                        results=[];
                        availableTags = [];
                        $.each(events, function(idx, obj) {
                            var index = idx+1;
                            var string = "";
                            availableTags.push(obj.name);  
                            results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                            for ($i=0; $i<obj.stars; $i++){
                                string += '<i class="fa fa-star"></i></li>';
                            }
                            if(asem){ currency = "$ "+obj.rate; }else{ currency = obj.rate+" ₮";}
                            if(obj.sold_out == 1){
                                innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                            }else{
                                innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                            }
                            $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');

                        });
                        $( "#tags" ).autocomplete({
                            source: availableTags
                        });
                        initMap(results);
                    }
                    });
                }
    }
    function tour_checked(){
        $("#tags").val('');
        var location = '{{location}}'.split(",");
        $.ajax({
            type: "POST",
            url: "search.php",
            data: {not_checked:1, city:location[0], type: "Resort"},
            success: function(data, textStatus, jqXHR)
        {
            $("#hotels").empty();

            var events = data['events'];
            var pages = data['pages'];
            results=[];
            availableTags = [];
            $.each(events, function(idx, obj) {
                var index = idx+1;
                var string = "";
                availableTags.push(obj.name);  
                results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                for ($i=0; $i<obj.stars; $i++){
                    string += '<i class="fa fa-star"></i></li>';
                }
                if(asem){ currency = "$ "+obj.rate; }else{ currency = obj.rate+" ₮";}
                if(obj.sold_out == 1){
                    innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                }else{
                    innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                }
                $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');

            });
            $( "#tags" ).autocomplete({
                source: availableTags
            });
            initMap(results);
        }
        });
    }
    $( "#tags" ).keyup(function(event) {
        var data;
        var keycode = (event.keyCode ? event.keyCode : event.which);
        var text =$('#tags').val();

        if(keycode == 8 && (text.length == 0) && keyup == true){

            var type = "Hotel";
            if(tour){ type = "Resort";}
            checkedValues1 = $(' input[name="stars"]:checkbox:checked').map(function() {return this.value;}).get();
            checkedValues2 = $(' input[name="others"]:checkbox:checked').map(function() {return this.value;}).get();
            checkedValues3 = $(' input[name="entertainment"]:checkbox:checked').map(function() {return this.value;}).get();
            checkedValues4 = $(' input[name="food_drink"]:checkbox:checked').map(function() {return this.value;}).get();
            checkedValues5 = $(' input[name="pool_spa"]:checkbox:checked').map(function() {return this.value;}).get();
            checkedValues6 = $(' input[name="transport"]:checkbox:checked').map(function() {return this.value;}).get();
            checkedValues7 = $(' input[name="miscellaneous"]:checkbox:checked').map(function() {return this.value;}).get();

            values1 = checkedValues1.toString();values2 = checkedValues2.toString();values3 = checkedValues3.toString();
            values4 = checkedValues4.toString();values5 = checkedValues5.toString();values6 = checkedValues6.toString();
            values7 = checkedValues7.toString();

            var location = '{{location}}'.split(",");

            if(checkedValues1.length !=0 || checkedValues2.length !=0  || checkedValues3.length !=0 || checkedValues4.length !=0 
                    || checkedValues5.length !=0 || checkedValues6.length !=0 || checkedValues7.length !=0){
                        checked(values1, values2, values3, values4, values5, values6, values7, location[0], type);
                    }else{
                        not_checked(type);
                    }

            keyup = false;
        }
        else{
            if(keycode == '13'){
                if(tour){
                    data = {search: $("#tags").val(), city:'Ulaanbaatar', type: "Resort"};
                }
                else{
                    data = {search: $("#tags").val(), city:'Ulaanbaatar', type: "Hotel"}; 
                }
                keyup = true;
                $('.spinner').remove();
                $(this).after('<div class="spinner"></div>');
                $.ajax({
                    type: "POST",
                    url: "search.php",
                    data: data,
                    success: function(data, textStatus, jqXHR)
                {
                    $('.spinner').remove();
                    $("#hotels").empty();

                    var events = data['events'];
                    var pages = data['pages'];

                    results=[];
                    $.each(events, function(idx, obj) {
                        var index = idx+1;
                        var string = "";
                        results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                        for ($i=0; $i<obj.stars; $i++){
                            string += '<i class="fa fa-star"></i></li>';
                        }
                        if(asem){ currency = "$ "+obj.rate; }else{ currency = obj.rate+" ₮";}
                        if(obj.sold_out == 1){
                            innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                        }else{
                            innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                        }
                        $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');

                    });
                }
                });
                initMap(results);
            }
        }
    });
    $("#location").geocomplete();

    $("#price-slider").ionRangeSlider({
        min: {{min}},
        max: {{max}},
        type: 'double',
        postfix: "₮",
        prettify: false,
        hasGrid: true,
        onFinish: function (data) {
            var location = '{{location}}'.split(",");
            var data;
            if(asem){
                data={price:1, city:location[0], asem:1, type: "Hotel", from: data.fromNumber, to: data.toNumber};
            }else{
                data={price:1, city:location[0], type: "Hotel", from: data.fromNumber, to: data.toNumber};
            }

            $('#full-loader').remove();
            $('#hotels').append('<div id="full-loader"><div id="loading"></div></div>');

            $.ajax({
                type: "POST",
                url: "search.php",
                data: data,
                success: function(data, textStatus, jqXHR)
            {
                $("#hotels").empty();

                var events = data['events'];
                var pages = data['pages'];
                results = [];
                availableTags = [];
                $.each(events, function(idx, obj) {
                    var index = idx+1;
                    var string = "";
                    availableTags.push(obj.name);  
                    results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                    for ($i=0; $i<obj.stars; $i++){
                        string += '<i class="fa fa-star"></i></li>';
                    }
                    if(asem){ currency = "$ "+obj.rate; }else{ currency = obj.rate+" ₮";}
                    if(obj.sold_out == 1){
                        innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                    }else{
                        innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                    }
                    $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');

                });
                $( "#tags" ).autocomplete({
                    source: availableTags
                });
                initMap(results);
            }
            });
        }
    });
    $('#hotels a[name="detail"]').click(function(){
        $('#full-loader').remove();
        $(this).append('<div id="full-loader"><div id="loading"></div></div>');
    });

    $(window).scroll(function()
    {
        if($(window).scrollTop() == $(document).height() - $(window).height())
        {
            if(checkSkip){
                $('div#loadmoreajaxloader').show();
                checkSkip = false;
                loadSkip++;
                checkedValues1 = $(' input[name="stars"]:checkbox:checked').map(function() {return this.value;}).get();
                checkedValues2 = $(' input[name="others"]:checkbox:checked').map(function() {return this.value;}).get();
                checkedValues3 = $(' input[name="entertainment"]:checkbox:checked').map(function() {return this.value;}).get();
                checkedValues4 = $(' input[name="food_drink"]:checkbox:checked').map(function() {return this.value;}).get();
                checkedValues5 = $(' input[name="pool_spa"]:checkbox:checked').map(function() {return this.value;}).get();
                checkedValues6 = $(' input[name="transport"]:checkbox:checked').map(function() {return this.value;}).get();
                checkedValues7 = $(' input[name="miscellaneous"]:checkbox:checked').map(function() {return this.value;}).get();

                values1 = checkedValues1.toString();values2 = checkedValues2.toString();values3 = checkedValues3.toString();
                values4 = checkedValues4.toString();values5 = checkedValues5.toString();values6 = checkedValues6.toString();
                values7 = checkedValues7.toString();

                var location = '{{location}}'.split(",");

                var data;
                if(asem){
                    data = {skip:loadSkip, filter1:values1, filter2:values2, entertainment:values3, food_drink:values4, pool_spa:values5, transport:values6,
                        miscellaneous:values7, city:location[0], asem:1, type: "Hotel"};
                }else{
                    data = {skip:loadSkip, filter1:values1, filter2:values2, entertainment:values3, food_drink:values4, pool_spa:values5, transport:values6,
                        miscellaneous:values7, city:location[0], type: "Hotel"};
                }
                $.ajax({
                    type: "POST",
                    url: "loadmore.php",
                    data: data,
                    success: function(data, textStatus, jqXHR)
                {
                    checkSkip = true;
                    $('div#loadmoreajaxloader').hide();
                    var events = data['events'];
                    var pages = data['pages'];

                    if(events.length == 0){
                        loadSkip--;
                    }
                $.each(events, function(idx, obj) {
                    var index = idx+1;
                    var string = "";
                    results.push({lat: obj.latitude, lng:obj.longitude, id: ''+obj.id, avg: ''+obj.rate});
                    for ($i=0; $i<obj.stars; $i++){
                        string += '<i class="fa fa-star"></i></li>';
                    }
                    if(asem){ currency = "$ "+obj.rate; }else{ currency = obj.rate+" ₮";}
                    if(obj.sold_out == 1){
                        innerHtml ='<span class="btn btn-primary small-left sold" id="'+obj.id+'">Sold out</span>';
                    }else{
                        innerHtml ='<span class="btn btn-primary small-left" id="'+obj.id+'">Өрөө сонгох</span>';
                    }
                    $("#hotels").append('<li><a asem="0" name="detail" class="booking-item" id="'+obj.id+'"><div class="row"><div class="col-md-3"><div class="booking-item-img-wrap"><img src="'+obj.cover+'" alt="Image Alternative text" title="LHOTEL PORTO BAY SAO PAULO suite lhotel living room" /><div class="booking-item-img-num"><i class="fa fa-picture-o"></i>29</div></div></div><div class="col-md-6"> <div class="flex"><div><h5 class="booking-item-title">'+obj.name+'</h5></div><div><div class="booking-item-rating mrg-left"><ul class="icon-group booking-item-rating-stars">'+string+'</ul></div></div></div><small class="booking-item-address"><i class="fa fa-map-marker"></i>'+ obj.address +'</small><br><br><small class="booking-item-address">'+obj.short_desc+'</small></div><div class="col-md-3"><span class="booking-item-price-from small-hidden" style="margin-bottom:8px">эхлэх үнэ</span><span class="booking-item-price">'+currency+'</span><span>/өдөр</span>'+innerHtml+'</div></div></a></li>');
                });
                initMap(results);
                //alert(data);

                }
                });
            }
        }
    });
    </script>
{% endblock %}
